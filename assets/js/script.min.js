import*as THREE from"three";import{GLTFLoader}from"three/addons/loaders/GLTFLoader.js";import{DRACOLoader}from"three/addons/loaders/DRACOLoader.js";function initializeThreeScene(){const e=document.getElementById("three-bg-container");if(!e)return;const t=new THREE.Scene;t.fog=new THREE.Fog(0,5,60);const n=new THREE.PerspectiveCamera(65,e.clientWidth/e.clientHeight,.1,200);n.position.set(0,0,15);const o=new THREE.Group,i=new THREE.Group,s=new THREE.Group;t.add(o,i,s);const a=new THREE.WebGLRenderer({antialias:window.innerWidth>768,alpha:!0,powerPreference:"high-performance",precision:"lowp"});a.setSize(e.clientWidth,e.clientHeight),a.setPixelRatio(Math.min(window.devicePixelRatio,1.5)),a.outputColorSpace=THREE.SRGBColorSpace,a.toneMapping=THREE.ACESFilmicToneMapping,a.toneMappingExposure=2,e.appendChild(a.domElement),t.add(new THREE.AmbientLight(16777215,1.5));const r=new THREE.DirectionalLight(16777215,4);r.position.set(5,10,7.5),t.add(r);const c=new THREE.PointLight(61695,20,15);i.add(c);const l=new THREE.PlaneGeometry(120,120,16,16),d=new THREE.MeshBasicMaterial({color:61695,wireframe:!0,transparent:!0,opacity:.1,depthWrite:!1}),h=new THREE.Mesh(l,d);h.rotation.x=-Math.PI/2,h.position.y=-8,i.add(h);const u=800,m=new THREE.BufferGeometry,f=new Float32Array(2400),p=new Float32Array(u);for(let e=0;e<2400;e+=3)f[e]=60*(Math.random()-.5),f[e+1]=40*(Math.random()-.5)+10,f[e+2]=60*(Math.random()-.5),p[e/3]=.22+.1*Math.random();m.setAttribute("position",new THREE.BufferAttribute(f,3));const v=new THREE.PointsMaterial({color:61695,size:.06,transparent:!0,opacity:.8}),w=new THREE.Points(m,v);i.add(w);const g=new DRACOLoader;g.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/");const E=new GLTFLoader;E.setDRACOLoader(g);let y=null,b=null,T=0,L=0;const x=new THREE.Vector3,M=new THREE.Box3,A={metalness:1,roughness:.2};function S(e,t){L=1.5*(e/window.innerWidth-.5),T=.8*(t/window.innerHeight-.5)}E.load("assets/blender/character/iron_man.glb",(e=>{y=e.scene,y.traverse((e=>{e.isMesh&&e.material&&(Object.assign(e.material,A),e.material.needsUpdate=!0)})),M.setFromObject(y),M.getSize(x);const t=12/Math.max(x.x,x.y,x.z);y.scale.setScalar(t),y.position.set(0,-6,0),c.position.set(0,-5,1.5),i.add(y)})),E.load("assets/blender/background/background_room.glb",(e=>{b=e.scene,b.traverse((e=>{e.isMesh&&(e.frustumCulled=!0)})),M.setFromObject(b),M.getSize(x);const t=30/Math.max(x.x,x.y,x.z);b.scale.setScalar(t),b.position.y=-4,o.add(b)}));let H=null;document.addEventListener("mousemove",(e=>{H||(H=setTimeout((()=>{S(e.clientX,e.clientY),H=null}),16))}),{passive:!0}),document.addEventListener("touchmove",(e=>{e.touches[0]&&S(e.touches[0].clientX,e.touches[0].clientY)}),{passive:!0});let R=0,$=0;const C=new THREE.Clock;let F=window.pageYOffset,I=document.documentElement.scrollHeight,P=window.innerHeight,O=null;window.addEventListener("scroll",(()=>{O||(O=setTimeout((()=>{F=window.pageYOffset,O=null}),16))}),{passive:!0});let Y=null;window.addEventListener("resize",(()=>{clearTimeout(Y),Y=setTimeout((()=>{I=document.documentElement.scrollHeight,P=window.innerHeight,n.aspect=e.clientWidth/P,n.updateProjectionMatrix(),a.setSize(e.clientWidth,e.clientHeight)}),150)}),{passive:!0}),function e(){requestAnimationFrame(e);const r=C.getElapsedTime(),l=Math.min(F/(.8*P),1);if(R+=.08*(l-R),$+=.08*((P+F>=I-750?1:0)-$),R=Math.max(0,Math.min(1,R)),$=Math.max(0,Math.min(1,$)),o.position.y=25*R,o.scale.setScalar(1-R),o.visible=R<.98,i.position.y=-25*(1-R)+25*$,i.scale.setScalar(1-$),i.visible=R>.02&&$<.98,o.visible&&b&&(b.rotation.y+=.1*(.5*L-b.rotation.y),b.rotation.x+=.1*(.2*T-b.rotation.x)),i.visible){h.position.z=2*Math.sin(.5*r);const e=w.geometry.attributes.position,t=e.array;for(let e=0;e<u;e++){const n=3*e+1;t[n]-=p[e],t[n]<-20&&(t[n]=30,t[n-1]=60*(Math.random()-.5),t[n+1]=60*(Math.random()-.5))}if(e.needsUpdate=!0,y){const e=.3*Math.sin(2.5*r);y.position.y=-6+e,c.position.set(0,-5+e,1.5),y.rotation.y+=.15*(L-y.rotation.y),y.rotation.x+=.15*(T-y.rotation.x);const t=25+10*Math.sin(5*r);c.intensity=t*R*(1-$)}}s.position.y=-25*(1-$),s.visible=$>.02,a.render(t,n)}(),window.cleanupThreeScene=function(){[l,m].forEach((e=>e?.dispose())),[d,v].forEach((e=>e?.dispose())),[y,b].forEach((e=>{e&&e.traverse((e=>{e.isMesh&&(e.geometry?.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach((e=>e.dispose())):e.material.dispose()))}))})),a.dispose(),a.domElement.remove()}}$(document).ready((function(){const e=$("#loading-bar"),t=$("#load-percent"),n=$("#dynamic-quote"),o=$("#loader-wrapper"),i=$("#typewriter"),s=$(".nav-link"),a=$(".dropdown-item"),r=$("#backToTop"),c=$(".navbar-collapse"),l=document.getElementById("contact-form"),d=65;let h=!1;$("html, body").css({"overflow-x":"hidden","overflow-y":"hidden","scroll-behavior":"smooth"});const u=["SWE Student","Full-Stack Web Developer","SQL Developer","WordPress Developer","PHP Developer","Laravel Developer","SEO"],m=["A cage went in search of a bird. — Franz Kafka","Man is sometimes extraordinarily, passionately, in love with suffering. — Fyodor Dostoevsky","He who has a why to live can bear almost any how. — Friedrich Nietzsche","It is better to be feared than loved, if one cannot be both. — Niccolò Machiavelli"];function f(){e.stop().css("width","100%"),t.text("100%"),setTimeout((()=>{o.length&&o.fadeOut(400,(function(){$(this).hide(),$("html, body").css({"overflow-y":"auto","overflow-x":"hidden"}),function(){const e=new IntersectionObserver((e=>{h||e.forEach((e=>{if(e.isIntersecting){const t=`#${e.target.id}`;s.add(a).removeClass("active").removeAttr("aria-current");const n=$(`.nav-link[href="${t}"], .dropdown-item[href="${t}"]`);n.addClass("active").attr("aria-current","page"),n.hasClass("dropdown-item")&&n.closest(".dropdown").find(".nav-link").addClass("active")}}))}),{rootMargin:`-${d}px 0px -45% 0px`,threshold:0});document.querySelectorAll("section[id]").forEach((t=>e.observe(t)))}()}))}),100)}n.length&&n.text(m[Math.floor(Math.random()*m.length)]);let p=0;const v=setInterval((()=>{p+=12*Math.random()+5,p>=96&&(p=96,clearInterval(v)),e.css("width",p+"%"),t.text(Math.floor(p)+"%")}),60),w=setTimeout(f,1500);$(window).on("load",(()=>{clearTimeout(w),f()})),s.add(a).on("click",(function(e){const t=$(this).attr("href");if(!t||t.startsWith("javascript"))return;const n=document.querySelector(t);if(n){e.preventDefault(),h=!0,s.add(a).removeClass("active").removeAttr("aria-current"),$(this).addClass("active").attr("aria-current","page"),$(this).hasClass("dropdown-item")&&$(this).closest(".dropdown").find(".nav-link").addClass("active");const t=n.getBoundingClientRect().top+window.pageYOffset-d+1;window.scrollTo({top:t,behavior:"smooth"}),setTimeout((()=>h=!1),850),c.hasClass("show")&&c.collapse("hide");const o=document.getElementById("offcanvasNavbar");o&&o.classList.contains("show")&&bootstrap.Offcanvas.getInstance(o).hide()}}));const g=document.getElementById("offcanvasNavbar");if(g){new bootstrap.Offcanvas(g);g.addEventListener("show.bs.offcanvas",(()=>{g.removeAttribute("inert")})),g.addEventListener("hide.bs.offcanvas",(()=>{g.setAttribute("inert","")}))}function E(e){e.cancelable&&e.preventDefault(),r.hasClass("firing")||(r.addClass("firing"),window.scrollTo({top:0,behavior:"smooth"}),setTimeout((()=>r.removeClass("firing")),1e3))}window.addEventListener("scroll",(()=>{r.toggleClass("show",window.scrollY>400)}),{passive:!0}),r.on("click",E),document.getElementById("backToTop")?.addEventListener("touchstart",E,{passive:!1});let y=0,b=0,T=!1;!function e(){if(!i.length)return;const t=u[y];T?(i.text(t.substring(0,b-1)),b--):(i.text(t.substring(0,b+1)),b++);let n=T?40:80;T||b!==t.length?T&&0===b&&(T=!1,y=(y+1)%u.length,n=500):(T=!0,n=2e3),setTimeout(e,n)}();const L=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&(e.target.classList.add("reveal-visible"),L.unobserve(e.target))}))}),{threshold:.1});function x(e,t){const n=document.getElementById(e);if(!n)return null;const o=new IntersectionObserver((e=>{e.forEach((e=>{e.target.classList.toggle(t,e.isIntersecting),e.target.classList.toggle("fog-fade-in",e.isIntersecting),e.target.classList.toggle("fog-fade-out",!e.isIntersecting)}))}),{threshold:.2,rootMargin:"0px"});return o.observe(n),o}document.querySelectorAll('[class*="reveal-"]').forEach((e=>L.observe(e))),x("education","camera-view-left-active"),x("skills","camera-view-right-active"),x("projects","camera-view-up-active"),x("certificates","camera-view-left-active");const M=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&e.target.querySelectorAll(".progress-bar").forEach((e=>{e.style.width=e.getAttribute("aria-valuenow")+"%"}))}))}),{threshold:.2});function A(e,t,n){e.forEach((e=>{let o=null,i=null;function s(){o=e.getBoundingClientRect()}function a(a){o||s();const r=a.clientX||(a.touches?a.touches[0].clientX:0),c=a.clientY||(a.touches?a.touches[0].clientY:0);i&&cancelAnimationFrame(i),i=requestAnimationFrame((()=>{if(!o)return;const i=(o.height/2-(c-o.top))/t,s=(r-o.left-o.width/2)/t;e.style.transform=`perspective(1000px) rotateX(${i}deg) rotateY(${s}deg) scale3d(${n},${n},${n})`}))}function r(){i&&cancelAnimationFrame(i),o=null,e.style.transform="perspective(1000px) rotateX(0deg) rotateY(0deg) scale3d(1,1,1)"}e.addEventListener("mouseenter",s,{passive:!0}),e.addEventListener("mousemove",a,{passive:!0}),e.addEventListener("touchstart",s,{passive:!0}),e.addEventListener("touchmove",a,{passive:!0}),e.addEventListener("mouseleave",r),e.addEventListener("touchend",r)}))}document.querySelectorAll(".skill-item").forEach((e=>M.observe(e))),function(){const e=document.getElementById("cursor-canvas");if(!e||"ontouchstart"in window||navigator.maxTouchPoints>0)return void(e&&(e.style.display="none"));const t=e.getContext("2d",{alpha:!0}),n=Array.from({length:10},(()=>({x:0,y:0})));let o=!1,i={x:0,y:0};function s(){e.width=window.innerWidth,e.height=window.innerHeight}window.addEventListener("mousemove",(e=>{o=!0,i.x=e.clientX,i.y=e.clientY}),{passive:!0}),window.addEventListener("resize",s,{passive:!0}),s(),function s(){if(t.clearRect(0,0,e.width,e.height),o){let e=i.x,o=i.y;n.forEach(((n,i)=>{n.x+=.4*(e-n.x),n.y+=.4*(o-n.y);const s=i%2==0?"#0ff0fc":"#00ff41",a=1-i/10,r=1.1*(10-i);t.globalAlpha=a,t.beginPath(),t.fillStyle=s,t.arc(n.x,n.y,r,0,2*Math.PI),t.fill(),e=n.x,o=n.y}))}requestAnimationFrame(s)}()}(),A(document.querySelectorAll(".project-card"),10,1.05),A(document.querySelectorAll(".skill-item"),15,1.02),document.querySelectorAll(".timeline-item").forEach((e=>{let t=null,n=null;function o(){t=e.getBoundingClientRect()}function i(i){t||o();const s=i.clientX||(i.touches?i.touches[0].clientX:0),a=i.clientY||(i.touches?i.touches[0].clientY:0);n&&cancelAnimationFrame(n),n=requestAnimationFrame((()=>{if(!t)return;const n=(t.height/2-(a-t.top))/10,o=(s-t.left-t.width/2)/10;e.style.transform=`perspective(2000px) rotateX(${n}deg) rotateY(${o}deg) translateZ(50px)`}))}function s(){n&&cancelAnimationFrame(n),t=null,e.style.transform="perspective(2000px) rotateX(0) rotateY(0) translateZ(0)"}e.addEventListener("mouseenter",o,{passive:!0}),e.addEventListener("mousemove",i,{passive:!0}),e.addEventListener("touchstart",o,{passive:!0}),e.addEventListener("touchmove",i,{passive:!0}),e.addEventListener("mouseleave",s),e.addEventListener("touchend",s)}));const S=document.querySelector(".glowing-text"),H=document.querySelector(".neon-border");if(S&&H){const P=S.innerText,O="!<>-_\\/[]{}—=+*^?________";let Y=null;H.addEventListener("mouseenter",(()=>{Y&&cancelAnimationFrame(Y);const e=performance.now();Y=requestAnimationFrame((function t(n){const o=(n-e)/50;S.innerText=P.split("").map(((e,t)=>t<o?e:O[Math.floor(Math.random()*O.length)])).join(""),o<P.length?Y=requestAnimationFrame(t):S.innerText=P}))}))}const R=document.querySelector("#about .neon-border");if(R){let k=null;function C(){k=R.getBoundingClientRect()}function F(){k=null,R.style.transform="rotateX(0) rotateY(0)",R.style.setProperty("--shine-x","50%"),R.style.setProperty("--shine-y","50%")}function I(e){if(window.innerWidth<992)return;k||C();const t=e.clientX||(e.touches?e.touches[0].clientX:0),n=e.clientY||(e.touches?e.touches[0].clientY:0);requestAnimationFrame((()=>{if(!k)return;const e=(k.height/2-(n-k.top))/20,o=(t-k.left-k.width/2)/30;R.style.transform=`rotateX(${e}deg) rotateY(${o}deg)`,R.style.setProperty("--shine-x",(t-k.left-k.width/2)/15*2+"%"),R.style.setProperty("--shine-y",-(k.height/2-(n-k.top))/10*2+"%")}))}window.addEventListener("mousemove",(e=>{if(window.innerWidth<992||!R)return;k||C();e.clientX>=k.left&&e.clientX<=k.right&&e.clientY>=k.top&&e.clientY<=k.bottom?I(e):F()}),{passive:!0}),R.addEventListener("touchstart",C,{passive:!0}),R.addEventListener("touchmove",I,{passive:!0}),R.addEventListener("mouseleave",F),R.addEventListener("touchend",F)}if(l){const q=document.getElementById("submit-btn");l.addEventListener("submit",(async function(e){e.preventDefault(),q.disabled=!0,q.innerHTML="Transmitting...";try{(await fetch("https://formspree.io/f/xgooljlk",{method:"POST",body:new FormData(this),headers:{Accept:"application/json"}})).ok&&($("#form-success").fadeIn(),this.reset(),$(this).fadeOut())}catch{alert("Transmission failed.")}finally{q.disabled=!1,q.innerHTML="Send Message"}}))}})),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initializeThreeScene):initializeThreeScene();